/* styles.css */
/* продолжаем */

/* Палитра и базовые */
:root{
  --beige:#f8f5ef;
  --beige-2:#efe8da;
  --ink:#0f172a;
  --muted:#475569;
  --card:#ffffff;
  --line:#e7e2d8;
  --pill:#f2eadc;
  --btn:#1f2937;
  --btn-text:#fff;
  --radius:16px;
  --radius-sm:10px;
  --shadow:0 4px 18px rgba(0,0,0,.06);
}

*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--beige);color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial}
.container{max-width:1200px;margin:0 auto;padding:24px}

/* Cards */
.card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);margin:16px 0;position:relative}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--line)}
.card-header h3{margin:0;font-size:18px}

/* Buttons */
.btn{appearance:none;border:1px solid var(--line);background:var(--card);color:var(--ink);padding:10px 14px;border-radius:10px;font-size:14px;cursor:pointer;transition:all .15s;display:inline-flex;align-items:center;gap:8px}
.btn:hover{transform:translateY(-1px);box-shadow:0 6px 16px rgba(0,0,0,.06)}
.btn.primary{background:#1f2937;color:#fff;border-color:#1f2937}
.btn.success{background:#10b981;color:#fff;border-color:#10b981}
.btn.danger{background:#ef4444;color:#fff;border-color:#ef4444}
.btn.small{padding:6px 10px;font-size:12px}
.btn.icon{padding:8px;border-radius:999px;min-width:36px;justify-content:center}

/* Fields */
.field{display:grid;gap:6px;margin-bottom:12px}
.field label{color:var(--muted);font-size:12px}
.field input,.field select{width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:var(--card);color:var(--ink);font-size:14px}
.field.compact{min-width:140px;max-width:200px}
.compact-input{width:100%;padding:8px 10px;border:1px solid var(--line);border-radius:10px;background:var(--card);color:var(--ink);font-size:13px}

/* Pills / badges */
.pill{display:inline-block;padding:6px 10px;border-radius:999px;background:var(--pill);border:1px solid var(--line);font-size:12px}
.badge{display:inline-block;padding:4px 8px;border-radius:8px;background:var(--pill);border:1px solid var(--line);font-size:12px;color:var(--muted);margin-right:8px}

/* Top section layout */
.top-section{display:flex;gap:20px;align-items:flex-start}
.stages-card{flex:1;min-width:0}
.settings-card{flex:1;min-width:0}
@media (max-width: 900px){.top-section{flex-direction:column}}

/* Tables common */
.calc-scroll{overflow:auto;border:1px solid var(--line);border-radius:12px;background:var(--card)}
.calc-table{min-width:1000px;width:100%;border-collapse:separate;border-spacing:0}
.calc-table th{position:sticky;top:0;background:#faf9f5;border-bottom:2px solid var(--line);padding:12px 10px;font-weight:600;font-size:12px}
.calc-table td{padding:10px;border-bottom:1px solid var(--line);text-align:center}
.base-strong,.line-total{font-weight:600;color:#1f6feb}

/* Range (До ключей, %) */
input[type="range"].range{ -webkit-appearance:none; appearance:none; width:100%; height:6px; background:#e7e2d8; border-radius:999px; outline:none }
input[type="range"].range::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:18px; height:18px; border-radius:50%; background:#1f2937; cursor:pointer; border:2px solid #fff; box-shadow:0 1px 3px rgba(0,0,0,.25) }
input[type="range"].range::-moz-range-thumb{ width:18px; height:18px; border-radius:50%; background:#1f2937; cursor:pointer; border:2px solid #fff; box-shadow:0 1px 3px rgba(0,0,0,.25) }
input[type="range"].range::-moz-range-track{ height:6px; background:#e7e2d8; border-radius:999px }

/* KPI block */
.kpi-header-pills{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
.kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:12px}
.kpi{border:1px solid var(--line);border-radius:12px;padding:14px;background:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:86px}
.kpi .muted{font-size:12px;color:var(--muted);margin-bottom:6px}
.kpi .v{font-size:16px;font-weight:700;color:#1f6feb}
.kpi.kpi-pair{gap:8px}
.kpi.kpi-pair .pair-item{width:100%;padding:4px 0;display:flex;flex-direction:column;align-items:center}
.kpi.kpi-pair .pair-item:not(:last-child){border-bottom:1px solid var(--line)}

/* Cashflow */
.cashflow-block .card-header h2{margin:0;font-size:18px}
.cashflow-scroll{overflow:auto;border:1px solid var(--line);border-radius:12px}
.factors-table{min-width:900px;width:100%;border-collapse:separate;border-spacing:0}
.factors-table th{position:sticky;top:0;background:#faf9f5;border-bottom:2px solid var(--line);padding:10px;font-weight:600;font-size:12px}
.factors-table td{padding:9px;border-bottom:1px solid var(--line);text-align:center}
.price-cell,.total-capital-cell,.rental-cell{font-weight:600;color:#0f172a}
.payment-cell{background:rgba(31,111,235,.06);font-weight:600;color:#1f6feb}
.positive{color:#dc2626;font-weight:600}
.negative{color:#16a34a;font-weight:600}

/* Stages table / scroll */
.stages-scroll{max-height:320px;overflow:auto}
.factors-table-container{border:1px solid var(--line);border-radius:12px;margin:16px 0;overflow:hidden}
.factors-table-scroll{overflow:auto}

/* Chart */
.pricing-chart-container{border:1px solid var(--line);border-radius:12px;padding:14px;background:#fff;margin-top:10px}
.pricing-chart-svg{border:1px solid var(--line);border-radius:12px;background:#faf9f5}

/* Modals */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);backdrop-filter:blur(6px);display:flex;align-items:center;justify-content:center;z-index:1000}
.modal-content{background:#fff;border:1px solid var(--line);border-radius:16px;max-width:90vw;max-height:80vh;overflow:auto;padding:18px;box-shadow:0 25px 50px -12px rgba(0,0,0,.25)}
.catalog-grid{max-height:400px;overflow:auto}
.project-group{margin-bottom:12px}
.villa-item{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--line);border-radius:12px;padding:10px;background:#fff;margin-bottom:8px;cursor:pointer}
.villa-item:hover{background:#1f6feb;color:#fff;border-color:#1f6feb}
.villa-info{display:flex;flex-direction:column;gap:4px}

/* Misc */
.row{display:flex;gap:12px;align-items:flex-end;flex-wrap:wrap}
.info-display{padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#faf9f5}

/* Reveal-on-mount */
.reveal{opacity:0;transform:translateY(14px) scale(.99);will-change:opacity,transform;transition:opacity .6s cubic-bezier(.2,.8,.2,1), transform .6s cubic-bezier(.2,.8,.2,1)}
.reveal.is-visible{opacity:1;transform:none}

/* Export buttons group */
.export-buttons{display:flex;gap:8px;flex-wrap:wrap}

/* Fine-tune responsive */
@media (max-width: 768px){
  .kpis{grid-template-columns:repeat(2, minmax(0,1fr))}
  .calc-table{min-width:820px}
}
@media (max-width: 480px){
  .kpis{grid-template-columns:1fr}
}

/* Table hovers */
.calc-table tr:hover td,
.factors-table tr:hover td{background:#faf9f5}

/* Scrollbars */
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:#f5f2ea;border-radius:8px}
::-webkit-scrollbar-thumb{background:#d9d3c7;border-radius:8px}
::-webkit-scrollbar-thumb:hover{background:#cfc8ba}

/* Text selection */
::selection{background:#1f6feb;color:#fff}
::-moz-selection{background:#1f6feb;color:#fff}

/* Focus */
.btn:focus,
.field input:focus,
.field select:focus{outline:2px solid #1f6feb;outline-offset:2px}

/* Small helpers */
.divider-line{width:80%;height:1px;background:var(--line);opacity:.5;margin:6px auto}
.adaptive-text{font-size:clamp(10px,2.5vw,12px);line-height:1.2;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}

/* Catalog layout (safe overrides) */
.catalog-section{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow);margin-top:16px}
.catalog-header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:14px}
.catalog-controls{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.search-input{width:260px;max-width:100%;padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff;color:var(--ink);font-size:14px}

.catalog-list{display:block}
.project-card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:16px;margin-bottom:14px;box-shadow:var(--shadow)}
.project-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid var(--line)}
.project-header h3{margin:0;font-size:18px;color:var(--ink)}
.project-actions{display:flex;gap:6px;flex-wrap:wrap}

.villas-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:12px}
.villa-card{background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px}
.villa-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
.villa-header h4{margin:0;font-size:16px;color:var(--ink)}
.villa-actions{display:flex;gap:6px;flex-wrap:wrap}

.villa-details{display:flex;flex-direction:column;gap:6px}
.detail-row{display:flex;align-items:center;justify-content:space-between;padding:6px 0;border-bottom:1px solid var(--line)}
.detail-row:last-child{border-bottom:0}
.label{color:var(--muted);font-size:12px}
.value{color:var(--ink);font-weight:600}

/* Компактные карточки каталога */
.villa-compact .specs{display:flex;gap:8px;flex-wrap:wrap;margin:6px 0}
.villa-compact .specs.subtle{opacity:.9}
.chip{padding:6px 10px;border:1px solid var(--line);border-radius:999px;background:#fff;font-size:12px;color:var(--ink)}
.chip.strong{font-weight:700;color:#1f6feb;border-color:#cfd6e6;background:#f2f6ff}

.status-pill{padding:4px 10px;border-radius:999px;font-size:12px;border:1px solid var(--line)}
.status-pill.ok{background:#eafff0;color:#067647;border-color:#b8ebc8}
.status-pill.warn{background:#fff7e6;color:#9a6700;border-color:#f0e0b2}
.status-pill.muted{background:#f2f3f5;color:#475569;border-color:#e1e4e8}

.more{margin-top:10px;border-top:1px solid var(--line);padding-top:10px}
.more-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:8px}
.more-grid .label{display:block;color:var(--muted);font-size:12px}
.more-grid .value{display:block;color:var(--ink);font-weight:600}

.btn.small{padding:6px 10px;font-size:12px;border-radius:10px}

@media (max-width:768px){
  .catalog-header{flex-direction:column;align-items:stretch}
  .search-input{width:100%}
  .project-actions{gap:8px}
}
